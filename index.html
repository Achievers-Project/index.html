<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RBI Game</title>
<style>
  /* Base (dark) theme */
  :root{
    --bg:#121212;
    --card:#1f1f1f;
    --muted:#aaa;
    --text:#eee;
    --accent:#6a5acd;
    --success:#35d46a;
    --danger:#ff5c5c;
    --warning:#ffbf00;
    --info:#00bfff;
    --glass: rgba(255,255,255,0.03);
  }
  body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:var(--bg);color:var(--text);transition:background .25s,color .25s;}
  .container{max-width:920px;margin:20px auto;padding:20px;background:var(--card);border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.6);}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;}
  h1{margin:0;font-size:22px}
  .controls{display:flex;gap:8px;align-items:center}
  .stats{display:flex;flex-wrap:wrap;gap:8px;justify-content:space-around;margin-bottom:14px}
  .stat{background:var(--glass);padding:8px 10px;border-radius:8px;font-weight:600;font-size:14px;min-width:140px;text-align:center}
  .graphContainer{margin:14px 0}
  .graphBar{height:22px;margin:6px 0;border-radius:8px;padding:2px 10px;color:#fff;display:flex;align-items:center;font-weight:600;box-sizing:border-box}
  .economyBar{background:var(--accent)}
  .bankBar{background:var(--success)}
  .publicBar{background:var(--danger)}
  .inflationBar{background:var(--warning);color:#111}
  .liquidityBar{background:var(--info)}
  .eventBox{background:#2b2b2b;padding:14px;border-radius:10px;min-height:80px;margin-bottom:12px;transition:opacity .25s}
  #buttonsArea{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
  #buttonsArea button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:#fff1;color:inherit;font-weight:700}
  #buttonsArea button:hover{opacity:.9}
  #timer{font-weight:700;text-align:center;margin-bottom:8px}
  footer{margin-top:16px;text-align:center;font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center;padding:0 10px}
  .image-container{text-align:center;margin-top:6px}
  .image-container img{vertical-align:middle;margin:0 10px}
  #hariRapContainer{margin-top:10px;padding:12px;background:#2f0000;border-radius:8px;color:#fff;white-space:pre-line;line-height:1.4;overflow:hidden;max-height:0;opacity:0;transition:max-height .4s ease,opacity .3s ease}
  #footerDontBtn{padding:6px 10px;background:var(--danger);color:white;border:none;border-radius:8px;cursor:pointer}
  #footerDontBtn:hover{background:#e04444}

  /* Light theme override */
  body.light{
    --bg:#f4f6fb;
    --card:#ffffff;
    --muted:#444;
    --text:#111;
    --glass: rgba(0,0,0,0.04);
  }

  /* Small screens */
  @media (max-width:520px){
    .stat{min-width:48%;font-size:13px}
    .container{padding:14px}
    h1{font-size:18px}
  }

  /* Simple utility */
  .hidden{display:none!important}
</style>
</head>
<body>
  <div class="image-container">
    <a href="https://potatotomato.netlify.app/" aria-label="External site">
      <img src="https://images.seeklogo.com/logo-png/16/1/rbi-logo-png_seeklogo-168562.png" alt="RBI logo" width="140">
    </a>
    <div style="display:inline-block;vertical-align:middle;font-weight:700;margin-left:8px">RBI Game</div>
  </div>

  <div class="container" role="main">
    <header>
      <h1 id="title">RBI Governor Simulator</h1>
      <div class="controls">
        <label style="font-size:14px">
          <input type="checkbox" id="themeToggle"> Light mode
        </label>
        <div id="monthDisplay" style="font-weight:700">Month: 1 / 12</div>
      </div>
    </header>

    <div class="stats" aria-live="polite">
      <div class="stat">Economy: <span id="economy">50</span></div>
      <div class="stat">Bank Health: <span id="bank">50</span></div>
      <div class="stat">Public Happiness: <span id="public">50</span></div>
      <div class="stat">Inflation: <span id="inflation">5%</span></div>
      <div class="stat">Liquidity: <span id="liquidity">50</span></div>
    </div>

    <div id="graphArea" class="graphContainer" aria-hidden="false"></div>

    <div id="timer">Time Left: <span id="timeNum">30</span>s</div>

    <div id="eventArea" class="eventBox" aria-live="assertive">Welcome â€” press an option when it appears.</div>

    <div id="buttonsArea" role="group" aria-label="Event choices"></div>

    <div id="messageArea" style="min-height:22px;margin-top:8px;color:var(--muted)"></div>

    <footer>
      <span>Made by Syed / RBIÂ©2025</span>
      <div>
        <button id="footerDontBtn">Don't click</button>
      </div>
    </footer>

    <div id="hariRapContainer" aria-hidden="true">
Yo Hari, always missing in the grind,
We code all night, you lag behind.
Ideas flowing, you just chill,
While we debug, you spill.
Step up now, face the heat,
Or watch your defeat repeat.
No contribution? Thatâ€™s your beat!
    </div>
  </div>

<script>
/* === Single-file consolidated and corrected game logic === */

document.addEventListener('DOMContentLoaded', ()=>{

  /* --- State --- */
  let economy = 50, bank = 50, publicHappiness = 50, inflation = 5, liquidity = 50;
  let month = 1, maxMonth = 12;
  let timer = null, timeLeft = 30;
  let currentEventIndex = -1;
  let inMiniGame = false;

  /* --- DOM refs --- */
  const economyEl = document.getElementById('economy');
  const bankEl = document.getElementById('bank');
  const publicEl = document.getElementById('public');
  const inflationEl = document.getElementById('inflation');
  const liquidityEl = document.getElementById('liquidity');
  const graphArea = document.getElementById('graphArea');
  const eventArea = document.getElementById('eventArea');
  const buttonsArea = document.getElementById('buttonsArea');
  const messageArea = document.getElementById('messageArea');
  const timeNum = document.getElementById('timeNum');
  const timerEl = document.getElementById('timer');
  const monthDisplay = document.getElementById('monthDisplay');
  const themeToggle = document.getElementById('themeToggle');
  const footerDontBtn = document.getElementById('footerDontBtn');
  const hariRap = document.getElementById('hariRapContainer');

  /* --- Events (month-based) --- */
  const events = [
    { text:"Inflation spikes unexpectedly!", options:[
      {text:"Raise interest rates sharply", econ:-5, bank:+5, pub:-7, infl:-3},
      {text:"Inject liquidity slowly", econ:+4, bank:-2, pub:+2, infl:+1, liq:+4},
      {text:"Do nothing", econ:-5, bank:0, pub:-5, infl:+5}
    ]},
    { text:"A major bank hides fraud reports!", options:[
      {text:"Launch surprise audit", econ:-3, bank:+6, pub:+1},
      {text:"Cover up quietly for govt", econ:0, bank:-2, pub:-6},
      {text:"Fine and restructure bank", econ:-1, bank:+4, pub:-1}
    ]},
    { text:"Public demands faster digital payments!", options:[
      {text:"Invest heavily in digital infrastructure", econ:+5, bank:+3, pub:+6, liq:+4},
      {text:"Ignore demands", econ:0, bank:0, pub:-8},
      {text:"Subsidize banks to improve services", econ:-3, bank:+4, pub:+3}
    ]},
    { text:"Sudden economic slowdown!", options:[
      {text:"Reduce interest rates", econ:+6, bank:-2, pub:+3, infl:+2},
      {text:"Send investigators (not military)", econ:-4, bank:0, pub:-6},
      {text:"Launch stimulus package", econ:+8, bank:-3, pub:+5, liq:-5}
    ]},
    { text:"Liquidity crunch reported by banks!", options:[
      {text:"Inject emergency funds", liq:+12, econ:+3, bank:+5, pub:+2},
      {text:"Invest on video games (lol)", liq:-5, econ:-3, bank:-3, pub:-3},
      {text:"Borrow from foreign banks", liq:+6, bank:+2}
    ]},
    { text:"RBI mobile app crashes repeatedly!", options:[
      {text:"Fix app immediately", pub:+8, liq:-3},
      {text:"Delay fix due to cost", pub:-7},
      {text:"Ignore complaints", pub:-12}
    ]},
    { text:"Foreign investment surges unexpectedly!", options:[
      {text:"Encourage further investment", econ:+6, bank:+2, pub:+2},
      {text:"Restrict some funds for safety", econ:-3, bank:-2, pub:-1},
      {text:"Monitor and report", econ:+1, bank:+1}
    ]},
    { text:"RBI faces cybersecurity attack!", options:[
      {text:"Invest heavily in security", liq:-5, bank:+5, pub:+3},
      {text:"Ignore minor attacks", bank:-2, pub:-3},
      {text:"Call for foreign support", liq:-3, bank:+3}
    ]},
    { text:"Public protests over rising inflation!", options:[
      {text:"Cut interest rates", econ:+5, pub:+3, infl:+2},
      {text:"Introduce subsidies", econ:-4, pub:+5, liq:-2},
      {text:"Ignore protests", pub:-8, econ:-2}
    ]},
    { text:"Banks report sudden fraudulent transactions!", options:[
      {text:"Audit banks aggressively", bank:+6, econ:-3, pub:+2},
      {text:"Cover quietly", bank:-10, pub:-5},
      {text:"Impose fines", bank:+3, econ:-1, pub:-2}
    ]},
    { text:"Sudden economic boom in export sector!", options:[
      {text:"Support exports with loans", econ:+6, bank:-2, liq:-3},
      {text:"Tax exports heavily", econ:-4, bank:+1, pub:-2},
      {text:"Invest in markets", econ:+2}
    ]},
    { text:"Year-end liquidity planning!", options:[
      {text:"Redistribute funds to needy banks", liq:+5, pub:+3, bank:+2},
      {text:"Invest in infrastructure", liq:-5, bank:+2, pub:-1},
      {text:"Adjust interest rates cautiously", infl:+1, econ:+1, bank:+1}
    ]},
  ];

  /* --- Mini-games --- */
  const miniEvents = [
    { text:"Allocate liquidity to a bank (drag coins)", type:"dragDrop", totalCoins:6 },
    { text:"Set interest rate", type:"slider", min:0, max:12 },
    { text:"Fund an economic project", type:"buttons", options:[
      {text:"Infrastructure", econ:+5, pub:+3, liq:-3},
      {text:"Digital Banking", econ:+3, bank:+5, liq:-2},
      {text:"Education", econ:+4, pub:+5, liq:-4}
    ]}
  ];

  /* --- Utilities --- */
  function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
  function clearTimer(){
    if(timer){ clearInterval(timer); timer = null; }
  }

  /* --- UI updates --- */
  function updateGraph(){
    // Inflation visual scale: inflation% * 4 (max 20 => 80%)
    const inflWidth = clamp(inflation*4, 0, 100);
    graphArea.innerHTML = `
      <div class="graphBar economyBar" style="width:${economy}%;"><span>Economy: ${economy}</span></div>
      <div class="graphBar bankBar" style="width:${bank}%;"><span>Bank Health: ${bank}</span></div>
      <div class="graphBar publicBar" style="width:${publicHappiness}%;"><span>Public: ${publicHappiness}</span></div>
      <div class="graphBar inflationBar" style="width:${inflWidth}%;"><span>Inflation: ${inflation}%</span></div>
      <div class="graphBar liquidityBar" style="width:${liquidity}%;"><span>Liquidity: ${liquidity}</span></div>
    `;
  }

  function updateStatsDisplay(){
    economyEl.textContent = economy;
    bankEl.textContent = bank;
    publicEl.textContent = publicHappiness;
    inflationEl.textContent = inflation + '%';
    liquidityEl.textContent = liquidity;
    updateGraph();
    monthDisplay.textContent = `Month: ${clamp(month,1,maxMonth)} / ${maxMonth}`;
  }

  /* --- Timer --- */
  function startTimer(seconds = 30){
    clearTimer();
    timeLeft = seconds;
    timeNum.textContent = timeLeft;
    timer = setInterval(()=>{
      timeLeft--;
      timeNum.textContent = timeLeft;
      if(timeLeft <= 0){
        clearTimer();
        messageArea.textContent = "Time's up â€” default action applied.";
        applyDefaultForCurrentEvent();
      }
    }, 1000);
  }

  function applyDefaultForCurrentEvent(){
    // If in mini-game, just continue to next month
    if(inMiniGame){
      messageArea.textContent = "Mini-game timed out. Proceeding.";
      endEventAndAdvance();
      return;
    }
    const idx = currentEventIndex;
    if(idx >= 0 && idx < events.length){
      const opt = events[idx].options[0];
      if(opt) applyOption(opt, "Default action applied.");
      else endEventAndAdvance();
    } else {
      endEventAndAdvance();
    }
  }

  /* --- Apply option (deltas) --- */
  function applyOption(opt, msg){
    clearTimer();
    // apply numeric deltas (normalize keys)
    economy = clamp(economy + (opt.econ || opt.economy || 0), 0, 100);
    bank = clamp(bank + (opt.bank || 0), 0, 100);
    publicHappiness = clamp(publicHappiness + (opt.pub || opt.public || 0), 0, 100);
    inflation = clamp(inflation + (opt.infl || opt.inflation || 0), 0, 20);
    liquidity = clamp(liquidity + (opt.liq || opt.liquidity || 0), 0, 100);

    messageArea.textContent = msg || (`Action: ${opt.text}`);
    updateStatsDisplay();

    // small delay then advance month / event
    setTimeout(()=>{
      endEventAndAdvance();
    }, 700);
  }

  function endEventAndAdvance(){
    // check immediate lose
    if(economy <= 0 || bank <= 0 || publicHappiness <= 0){
      gameOver();
      return;
    }
    month++;
    if(month > maxMonth){
      // reached end, evaluate result
      gameOver();
      return;
    }
    // proceed to next event
    inMiniGame = false;
    nextEvent();
  }

  /* --- Game over / restart --- */
  function gameOver(){
    clearTimer();
    buttonsArea.innerHTML = `<button id="restartBtn">Restart Game</button>`;
    document.getElementById('restartBtn').addEventListener('click', restartGame);
    timerEl.textContent = '';
    // Message according to performance
    if(economy > 70 && bank > 60 && publicHappiness > 60){
      messageArea.textContent = "Legendary Governor! You win! Good Game.";
    } else if(economy < 50 && bank < 50){
      messageArea.textContent = "You are not fit to be an RBI Governor ðŸ¥²";
    } else {
      messageArea.textContent = "Game over â€” check stats and try again.";
    }
    eventArea.textContent = "Session ended.";
  }

  function restartGame(){
    clearTimer();
    economy = 50; bank = 50; publicHappiness = 50; inflation = 5; liquidity = 50;
    month = 1; currentEventIndex = -1; inMiniGame = false;
    messageArea.textContent = '';
    updateStatsDisplay();
    nextEvent();
  }

  /* --- Event rendering --- */
  function renderEvent(evt){
    fadeContent(() => {
      eventArea.textContent = `Month ${month}: ${evt.text}`;
      buttonsArea.innerHTML = '';
      evt.options.forEach(opt=>{
        const btn = document.createElement('button');
        btn.textContent = opt.text;
        btn.addEventListener('click', ()=> applyOption(opt));
        buttonsArea.appendChild(btn);
      });
    });
    startTimer(30);
  }

  /* --- Mini-game rendering --- */
  function startMiniGame(evt){
    inMiniGame = true;
    clearTimer();
    buttonsArea.innerHTML = '';
    fadeContent(()=> {
      eventArea.innerHTML = `<strong>Mini-Game:</strong> ${evt.text}`;
      if(evt.type === 'dragDrop'){
        // create coins
        const coinsWrapper = document.createElement('div');
        coinsWrapper.style.marginTop = '10px';
        let created = 0;
        for(let i=0;i<evt.totalCoins;i++){
          const coin = document.createElement('span');
          coin.textContent = 'ðŸ’°';
          coin.style.fontSize = '22px';
          coin.style.margin = '6px';
          coin.style.cursor = 'grab';
          coin.draggable = true;
          coin.dataset.value = '1';
          coin.addEventListener('dragstart', (e)=> e.dataTransfer.setData('text/plain', '1'));
          coinsWrapper.appendChild(coin);
          created++;
        }
        eventArea.appendChild(coinsWrapper);

        // drop target
        const bankDrop = document.createElement('div');
        bankDrop.textContent = 'ðŸ¦ Drop coins here to add liquidity';
        bankDrop.style.border = '2px dashed rgba(255,255,255,0.25)';
        bankDrop.style.padding = '12px';
        bankDrop.style.marginTop = '12px';
        bankDrop.style.borderRadius = '8px';
        bankDrop.addEventListener('dragover', (e)=> e.preventDefault());
        bankDrop.addEventListener('drop', (e)=>{
          e.preventDefault();
          const v = parseInt(e.dataTransfer.getData('text/plain') || '1',10);
          // each coin gives +5 liquidity
          liquidity = clamp(liquidity + 5 * v, 0, 100);
          updateStatsDisplay();
          messageArea.textContent = 'Liquidity allocated to banks!';
          // remove the dragged coin visually (try to remove the first matching coin)
          const coinEl = coinsWrapper.querySelector('span');
          if(coinEl) coinEl.remove();
          // if no more coins, finish mini-game
          if(coinsWrapper.querySelectorAll('span').length === 0){
            setTimeout(()=> endEventAndAdvance(), 700);
          }
        });
        eventArea.appendChild(bankDrop);
      }
      else if(evt.type === 'slider'){
        const input = document.createElement('input');
        input.type = 'range';
        input.min = evt.min; input.max = evt.max; input.value = Math.round((evt.min+evt.max)/2);
        input.style.width = '90%'; input.style.marginTop = '12px';
        buttonsArea.appendChild(input);
        const submit = document.createElement('button');
        submit.textContent = 'Set Rate';
        submit.addEventListener('click', ()=>{
          inflation = clamp(Math.round(input.value * 1.0), 0, 20);
          messageArea.textContent = `Interest policy set. Inflation now ${inflation}%`;
          updateStatsDisplay();
          setTimeout(()=> endEventAndAdvance(), 700);
        });
        buttonsArea.appendChild(submit);
      }
      else if(evt.type === 'buttons'){
        evt.options.forEach(opt=>{
          const b = document.createElement('button');
          b.textContent = opt.text;
          b.addEventListener('click', ()=>{
            applyOption(opt);
          });
          buttonsArea.appendChild(b);
        });
      }
    });
    // mini-game timer (gives less time)
    startTimer(20);
  }

  /* --- Fade helper --- */
  function fadeContent(fn){
    eventArea.style.opacity = 0;
    buttonsArea.style.opacity = 0;
    setTimeout(()=>{ fn(); eventArea.style.opacity = 1; buttonsArea.style.opacity = 1; }, 180);
  }

  /* --- Next event logic (with mini-game chance) --- */
  function nextEvent(){
    // safety: clear UI
    clearTimer();
    buttonsArea.innerHTML = '';

    // Check end conditions immediately
    if(economy <= 0 || bank <= 0 || publicHappiness <= 0){
      gameOver(); return;
    }
    if(month > maxMonth){
      gameOver(); return;
    }

    // 30% chance to trigger a mini-game instead of a normal monthly event
    const willMini = Math.random() < 0.30;
    if(willMini){
      const me = miniEvents[Math.floor(Math.random()*miniEvents.length)];
      startMiniGame(me);
      return;
    }

    // Regular month event
    currentEventIndex = clamp(month-1, 0, events.length-1);
    const evt = events[currentEventIndex];
    renderEvent(evt);
  }

  /* --- Initialize --- */
  function init(){
    // theme toggle
    themeToggle.addEventListener('change', ()=> {
      document.body.classList.toggle('light', themeToggle.checked);
    });

    // Hari rap toggle
    let rapOpen = false;
    footerDontBtn.addEventListener('click', ()=>{
      rapOpen = !rapOpen;
      if(rapOpen){
        hariRap.style.maxHeight = '420px';
        hariRap.style.opacity = 1;
        hariRap.setAttribute('aria-hidden','false');
        footerDontBtn.textContent = 'Close rap';
      } else {
        hariRap.style.maxHeight = '0';
        hariRap.style.opacity = 0;
        hariRap.setAttribute('aria-hidden','true');
        footerDontBtn.textContent = "Don't click";
      }
    });

    // tasteful title easter egg
    const title = document.getElementById('title');
    let clickCount = 0;
    title.addEventListener('click', ()=>{
      clickCount++;
      if(clickCount >= 10){
        messageArea.textContent = "ðŸ’¥ Secret RBI Hack Activated! SQUIRREL BOUTA DANCE ON ALL FOURS ðŸ’¥";
        clickCount = 0;
      }
    });

    // start game
    updateStatsDisplay();
    nextEvent();
  }

  /* Expose some helpers for testing in console (optional) */
  window.__RBI = { restartGame, gameOver };

  // run init
  init();

});
</script>
</body>
</html>
